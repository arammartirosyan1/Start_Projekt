<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Terminal</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm/css/xterm.css">
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #terminal-container {
            width: 80%;
            height: 300px;
            margin: auto;
            border: 1px solid black;
            padding: 10px;
            background-color: black;
            color: white;
        }
    </style>
</head>
<body>

    <h2>Web Terminal (Supports JavaScript & Python)</h2>
    <label for="mode">Select Mode:</label>
    <select id="mode">
        <option value="js">JavaScript</option>
        <option value="python">Python</option>
    </select>
    
    <div id="terminal-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/xterm/lib/xterm.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const term = new Terminal({ cursorBlink: true, rows: 15 });
            term.open(document.getElementById('terminal-container'));
            term.writeln("Welcome to the web terminal!");
            term.write("$ ");
            
            let command = "";
            let mode = "js";  // Default mode: JavaScript

            const ws = new WebSocket("ws://localhost:8000/ws");  // Connect to WebSocket server

            document.getElementById("mode").addEventListener("change", function (e) {
                mode = e.target.value;
                term.writeln(`\n[Switched to ${mode.toUpperCase()} mode]`);
                term.write("$ ");
            });

            term.onData(e => {
                if (e === "\r") { // Enter key
                    term.write("\n");
                    if (mode === "js") {
                        try {
                            let result = eval(command);  // Execute JavaScript
                            term.writeln(String(result));
                        } catch (error) {
                            term.writeln("Error: " + error.message);
                        }
                        term.write("$ ");
                    } else if (mode === "python") {
                        ws.send(command);  // Send command to Deno server
                    }
                    command = "";
                } else if (e === "\x7F") { // Backspace
                    if (command.length > 0) {
                        command = command.slice(0, -1);
                        term.write("\b \b");
                    }
                } else {
                    command += e;
                    term.write(e);
                }
            });

            ws.onmessage = (event) => {
                term.writeln(event.data);  // Print Python result
                term.write("$ ");
            };
        });
    </script>

</body>
</html>
